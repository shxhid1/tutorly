
{
  "rules": {
    // Default deny all
    ".read": false,
    ".write": false,
    
    "users": {
      "$userId": {
        // Users can read and write their own data
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null && auth.uid === $userId",
        
        // Admins can read all user data
        ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() === 'admin'"
      }
    },
    
    "progress": {
      "$userId": {
        // Users can read and write their own progress data
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null && auth.uid === $userId"
      }
    },
    
    "notes": {
      "$userId": {
        // Users can read and write their own notes
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null && auth.uid === $userId",
        
        "$noteId": {
          // Validate note data structure
          ".validate": "newData.hasChildren(['id', 'content', 'createdAt', 'updatedAt'])",
          "id": {
            ".validate": "newData.isString()"
          },
          "content": {
            ".validate": "newData.isString()"
          },
          "createdAt": {
            ".validate": "newData.isString()"
          },
          "updatedAt": {
            ".validate": "newData.isString()"
          }
        }
      }
    },
    
    "backups": {
      "$userId": {
        // Users can read and write their own backups
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null && auth.uid === $userId"
      }
    },
    
    // Admin-only access to system settings
    "settings": {
      ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() === 'admin'",
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() === 'admin'"
    }
  }
}
